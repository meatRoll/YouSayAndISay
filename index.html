<!DOCTYPE html>
<html lang="en">

<head>
	<title></title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1">
	<script>
		document.documentElement.style.fontSize = window.screen.width / 10 + 'px';
	</script>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			font-family: 'microsoft yahei';
		}

		a,
		span {
			text-decoration: none;
			-webkit-tap-highlight-color: transparent;
		}

		ul,
		ol {
			list-style: none;
		}

		input {
			border: none;
			outline: none;
		}

		img {
			display: block;
		}

		html,
		body {
			width: 100%;
			height: 100%;
			overflow: hidden;
		}

		.clearfix::before,
		.clearfix::after {
			content: '';
			visibility: hidden;
			clear: both;
			line-height: 0;
			height: 0;
			display: block;
		}

		.f_l {
			float: left;
		}

		.f_r {
			float: right;
		}

		.container {
			width: 100%;
			height: 100%;
			display: flex;
			flex-direction: column;
			position: relative;
			transition: 0.5s;
		}

		.top {
			width: 100%;
			height: 1.5rem;
			background-color: #999;
			padding: 0 0.5rem;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}

		.top h1 {
			line-height: 1.5rem;
			font-size: 0.95rem;
			color: #f0f0f0;
		}

		.top .setting {
			width: 1.2rem;
			height: 1.2rem;
			background: url('images/setting.png') no-repeat center/100%;
		}

		.message {
			flex: 1;
			overflow-y: scroll;
			padding: 0 0.3rem;
			box-sizing: border-box;
			padding-top: 0.2rem;
		}

		.control {
			width: 100%;
			height: 1.7rem;
			overflow: hidden;
			display: flex;
			justify-content: space-around;
			align-items: center;
			background-color: #999;
		}

		.inputBox {
			width: 75%;
			height: 1.3rem;
			line-height: 1.3rem;
			border-radius: 0.2rem;
			font-size: 0.6rem;
			text-indent: 0.2rem;
		}

		.sendButton {
			width: 18%;
			height: 1.3rem;
			line-height: 1.3rem;
			text-align: center;
			background-color: #fff;
			border-radius: 0.3rem;
			color: #333;
			font-weight: 700;
			font-size: 0.6rem;
			cursor: pointer;
		}

		.message>div>a {
			width: 1.35rem;
			height: 1.35rem;
			border-radius: 50%;
			background-color: skyblue;
			text-align: center;
			line-height: 1.35rem;
			color: white;
			font-size: 0.8rem;
			font-weight: 700;
		}

		.message>.robot>a {
			background: url('images/é€—é€¼è‚‰ä¸¸.png') no-repeat center/1.35rem;
		}

		.message>.self>a {
			background-color: yellowgreen;
		}

		.message>div {
			padding: 0.1rem 0;
			display: none;
		}

		.message>div>p {
			max-width: 7.5rem;
			min-height: 1.5rem;
			margin: 0 0.25rem;
			padding: 0.25rem;
			line-height: 1rem;
			background-color: #ccc;
			border-radius: 10px;
			word-break: break-all;
			position: relative;
			font-weight: 400;
			color: white;
			font-size: 0.5rem;
		}

		.message>.robot>p {
			background-color: skyblue;
		}

		.message>.robot>p::before {
			content: '';
			position: absolute;
			border-top: 0.15rem solid transparent;
			border-bottom: 0.15rem solid transparent;
			border-right: 0.15rem solid skyblue;
			left: -0.14rem;
			top: 0.5rem;
		}

		.message>.self>p {
			color: black;
		}

		.message>.self>p::before {
			content: '';
			position: absolute;
			border-top: 0.15rem solid transparent;
			border-bottom: 0.15rem solid transparent;
			border-left: 0.15rem solid #ccc;
			right: -0.14rem;
			top: 0.5rem;
		}

		.moveLeft {
			transform: translateX(-5rem);
		}

		.settingBox {
			width: 5rem;
			height: 100%;
			position: absolute;
			top: 0;
			right: -5rem;
			background-color: #848484;
			display: flex;
			flex-direction: column;
		}

		.settingBox h2 {
			width: 100%;
			height: 1.5rem;
			font-size: 0.95rem;
			text-indent: 0.5rem;
			line-height: 1.5rem;
		}

		.settingBox ul {
			flex: 1;
			width: 100%;
		}

		.settingBox ul li {
			width: 100%;
			min-height: 1.5rem;
			overflow: hidden;
			display: flex;
			align-items: center;
			font-size: 0.5rem;
		}

		.settingBox ul li input {
			width: 0.5rem;
			height: 0.5rem;
			margin: 0 0.3rem;
		}

		.settingBox ul li label {
			flex: 1;
		}
	</style>
</head>

<body>
	<div class="container">
		<div class="top">
			<h1>MeatRoll</h1>
			<a href="javascript:void(0);" class="setting"></a>
		</div>
		<div class="message">
			<!-- æœºå™¨äººçš„èŠå¤©æ¡† -->
			<div class="robot clearfix">
				<a href="javascript:void(0);" class='f_l'></a>
				<p class='f_l'></p>
			</div>
			<!-- è‡ªå·±çš„èŠå¤©æ¡† -->
			<div class="self clearfix">
				<a href="javascript:void(0);" class="f_r">æˆ‘</a>
				<p class="f_r"></p>
			</div>
		</div>
		<div class="control">
			<input type="text" class='inputBox'>
			<input type="button" class='sendButton' value='send'>
		</div>
		<div class="settingBox">
			<h2>Setting</h2>
			<ul>
				<li>
					<input type="checkbox" id="sendChoice1"><label for="sendChoice1">Send By 'Enter'</label>
				</li>
				<li>
					<input type="checkbox" id="sendChoice2"><label for="sendChoice2">Send By 'Ctrl+Enter'</label>
				</li>
			</ul>
		</div>
</body>

</html>

<script>
	window.onload = function () {
		var robotBox = document.querySelector('.robot');
		var selfBox = document.querySelector('.self');
		var textBox = document.querySelector('.inputBox');
		var messageBox = document.querySelector('.message');
		var btn = document.querySelector('.sendButton');
		var container = document.querySelector('.container');
		var checkBox = document.querySelectorAll('input[type=\'checkbox\']');

		// è®©æœºå™¨äººè®²ç‚¹ä»€ä¹ˆ
		setTimeout(function () {
			robotSay('å¥½æƒ³è¯´ç‚¹ä»€ä¹ˆğŸ˜ˆ');
		}, 1000);

		btn.onclick = function () {
			// å¦‚æœè¾“å…¥å†…å®¹ä¸ºç©ºï¼Œåˆ™ä¸åšä»»ä½•æ“ä½œ
			if (textBox.value === '') return;

			// å°†è¾“å…¥å¾—å†…å®¹å‘é€å‡ºå»
			var selfBoxClone = selfBox.cloneNode(true);
			selfBoxClone.style.display = 'block';
			selfBoxClone.querySelector('p').textContent = textBox.value;
			messageBox.appendChild(selfBoxClone);

			// å°†å†…å®¹å‘é€ç»™æœåŠ¡å™¨
			var xhr = new XMLHttpRequest;
			xhr.open('post', 'http://www.tuling123.com/openapi/api');
			xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')
			xhr.onload = function () {
				// è·å¾—æœåŠ¡å™¨è¿”å›çš„å†…å®¹å¹¶åŠ è½½å‡ºæ¥
				eval('var response = ' + xhr.responseText);

				// è®©æœºå™¨äººè®²è¯
				robotSay(response['text']);

				// æ»šåŠ¨æ¡æ»šåŠ¨åˆ°æœ€åº•éƒ¨
				messageBox.scrollTop = 99999999999;
			};
			xhr.send('key=4eaf1e4af9ec47119006902d47ba2117&info=' + textBox.value);

			// æ¸…ç©ºè¾“å…¥æ¡†çš„å†…å®¹
			textBox.value = '';

			// æ»šåŠ¨æ¡æ»šåŠ¨åˆ°æœ€åº•éƒ¨
			messageBox.scrollTop = 99999999999;
		};

		// åˆ›å»ºä¸€ä¸ªæ•°ç»„ä¿å­˜æ•°æ®
		var arrFor2 = [];

		// è®¾ç½®é€‰é¡¹ï¼Œè®¾ç½®åªèƒ½å•ç‹¬é€‰ä¸­ä¸€ä¸ª
		for (var i = 0; i < checkBox.length; i++) {
			checkBox[i].index = i;
			checkBox[i].onclick = function (event) {
				if (this.checked) {
					for (var i = 0; i < checkBox.length; i++) {
						checkBox[i].checked = false;
					}
					this.checked = true;
					if (this.index == 0) {
						// è¾“å…¥æ¡†ä½¿ç”¨enterå‘é€ä¿¡æ¯
						textBox.onkeydown = function (event) {
							if (event.keyCode == 13) btn.click();
						};
					} else if (this.index == 1) {
						// è¾“å…¥æ¡†ä½¿ç”¨Ctrlå’Œenterå‘é€ä¿¡æ¯
						textBox.onkeydown = function (event) {
							// é”®ç›˜å¼¹èµ·å°±æ¸…ç©ºæ•°ç»„
							this.onkeyup = function () {
								arrFor2 = [];
							};
							// å¦‚æœæ•°ç»„é•¿åº¦ä¸º0ï¼Œå°±æŠŠé”®å€¼ä¿å­˜è¿›æ•°ç»„
							if (arrFor2.length == 0) {
								if (event.keyCode == 17) arrFor2.push(true);
							} else {
								if (event.keyCode == 13) btn.click();
								arrFor2 = [];
							}
						};
					}
				}
			};
		}

		// å¦‚æœä¸¤ä¸ªé€‰é¡¹éƒ½æ˜¯flaseï¼Œåˆ™æ¸…ç©ºonkeydownçš„äº‹ä»¶
		if (!checkBox[0].checked && !checkBox[1].checked) textBox.onkeydown = null;

		// å±•å¼€æˆ–æ”¶èµ·è®¾ç½®æ 
		document.querySelector('.setting').onclick = function () {
			container.classList.toggle('moveLeft');
		};

		// æœºå™¨äººè¯´è¯çš„å‡½æ•°
		function robotSay(text) {
			var robotBoxClone = robotBox.cloneNode(true);
			robotBoxClone.style.display = 'block';
			robotBoxClone.querySelector('p').textContent = text;
			messageBox.appendChild(robotBoxClone);
		}
	};
</script>
